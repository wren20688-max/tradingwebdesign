<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Auto Trading ‚Äî PreoTrade FX</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="top-nav">
    <div class="nav-left">
      <button id="menuToggle" class="menu-toggle">‚ò∞</button>
      <div class="logo" style="width: 32px; height: 32px; margin: 0 8px;">
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="logoGradient1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#0055ff;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:1" />
            </linearGradient>
          </defs>
          <circle cx="100" cy="100" r="95" fill="none" stroke="url(#logoGradient1)" stroke-width="2" opacity="0.3"/>
          <path d="M 100 30 L 150 60 L 150 130 L 100 160 L 50 130 L 50 60 Z" fill="url(#logoGradient1)" opacity="0.1"/>
          <g>
            <rect x="70" y="95" width="8" height="35" fill="#00d084" opacity="0.9"/>
            <line x1="74" y1="85" x2="74" y2="135" stroke="#00d084" stroke-width="2"/>
            <rect x="85" y="75" width="8" height="55" fill="#00d084" opacity="0.95"/>
            <line x1="89" y1="65" x2="89" y2="135" stroke="#00d084" stroke-width="2"/>
            <rect x="100" y="55" width="8" height="75" fill="#0055ff" opacity="1"/>
            <line x1="104" y1="45" x2="104" y2="135" stroke="#0055ff" stroke-width="2"/>
            <rect x="115" y="80" width="8" height="50" fill="#00d4ff" opacity="0.9"/>
            <line x1="119" y1="70" x2="119" y2="135" stroke="#00d4ff" stroke-width="2"/>
          </g>
        </svg>
      </div>
      <h1>PreoTrade FX</h1>
    </div>
    <div class="nav-center">
      <span class="balance-display">Balance: <strong id="balance">$10,000.00</strong></span>
    </div>
    <div class="nav-right">
      <button id="toggleMode" class="nav-btn">Theme</button>
      <a href="index.html" class="nav-btn logout">Logout</a>
    </div>
  </header>

  <nav id="sideMenu" class="side-menu">
    <button class="menu-close">&times;</button>
    <div class="menu-items">
      <a href="dashboard.html" class="menu-item">Dashboard</a>
      <a href="auto-trading.html" class="menu-item active">Auto Trading</a>
      <a href="finances.html" class="menu-item">Finances</a>
      <a href="transactions.html" class="menu-item">Transactions</a>
      <a href="payment-methods.html" class="menu-item">Payment Methods</a>
      <a href="profile.html" class="menu-item">Profile</a>
    </div>
  </nav>

  <main class="main-container page-container">
    <div class="page-header">
      <h2>Automated Trading Bot</h2>
      <p id="botStatus">Status: <span id="botStatusText" style="color:var(--danger);">Stopped</span></p>
    </div>

    <section class="content-card">
      <h3>Configuration</h3>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
        <div class="form-group">
          <label>Trading Pair</label>
          <select id="botPair">
            <option value="EUR/USD">EUR/USD</option>
            <option value="GBP/USD">GBP/USD</option>
            <option value="USD/JPY">USD/JPY</option>
            <option value="Bitcoin">Bitcoin</option>
            <option value="Ethereum">Ethereum</option>
          </select>
        </div>
        <div class="form-group">
          <label>Trading Strategy</label>
          <select id="botStrategy">
            <option value="MA">Moving Average</option>
            <option value="RSI">RSI Crossover</option>
            <option value="MACD">MACD</option>
            <option value="Grid">Grid Trading</option>
          </select>
        </div>
        <div class="form-group">
          <label>Volume per Trade</label>
          <input type="number" id="botVolume" value="0.1" min="0.01" step="0.01">
        </div>
        <div class="form-group">
          <label>Max Daily Trades</label>
          <input type="number" id="botMaxTrades" value="10" min="1" step="1">
        </div>
        <div class="form-group">
          <label>Take Profit (%)</label>
          <input type="number" id="botTakeProfit" value="2" min="0.1" step="0.1">
        </div>
        <div class="form-group">
          <label>Stop Loss (%)</label>
          <input type="number" id="botStopLoss" value="1" min="0.1" step="0.1">
        </div>
      </div>
      <div style="display:flex; gap:12px;">
        <button id="startBotBtn" class="action-btn btn-primary" style="flex:1;">‚ñ∂Ô∏è Start Bot</button>
        <button id="stopBotBtn" class="action-btn btn-danger" style="flex:1; opacity:0.5;" disabled>‚èπÔ∏è Stop Bot</button>
        <button id="resetBotBtn" class="action-btn btn-secondary" style="flex:1;">üîÑ Reset</button>
      </div>
    </section>

    <section class="content-card">
      <h3>Performance Statistics</h3>
      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:15px;">
        <div class="stat-card">
          <div style="font-size:24px; font-weight:bold; color:var(--text-primary);" id="statTrades">0</div>
          <div style="font-size:12px; color:var(--text-tertiary); margin-top:5px;">Trades Executed</div>
        </div>
        <div class="stat-card">
          <div style="font-size:24px; font-weight:bold; color:var(--success);" id="statWins">0</div>
          <div style="font-size:12px; color:var(--text-tertiary); margin-top:5px;">Winning Trades</div>
        </div>
        <div class="stat-card">
          <div style="font-size:24px; font-weight:bold; color:var(--danger);" id="statLosses">0</div>
          <div style="font-size:12px; color:var(--text-tertiary); margin-top:5px;">Losing Trades</div>
        </div>
        <div class="stat-card">
          <div style="font-size:24px; font-weight:bold; color:var(--success);" id="statPnL">$0.00</div>
          <div style="font-size:12px; color:var(--text-tertiary); margin-top:5px;">Today's P&L</div>
        </div>
      </div>
    </section>

    <section class="content-card">
      <h3>Activity Log</h3>
      <div id="botLog" style="height:300px; overflow-y:auto; background:var(--bg-secondary); padding:15px; border-radius:var(--radius-md); border:1px solid var(--border-color); font-family:monospace; font-size:12px; color:var(--secondary);">
        Ready to start bot. Click "Start Bot" to begin automated trading...
      </div>
    </section>
  </main>

  <script src="storage.js"></script>
  <script>
    let botRunning = false;
    let botStats = { trades: 0, wins: 0, losses: 0, pnl: 0 };

    document.addEventListener('DOMContentLoaded', () => {
      if (!storage.isLoggedIn()) {
        window.location.href = 'index.html';
        return;
      }

      const user = storage.getUser();
      if (user) {
        loadBalance();
      }

      document.getElementById('startBotBtn').addEventListener('click', startBot);
      document.getElementById('stopBotBtn').addEventListener('click', stopBot);
      document.getElementById('resetBotBtn').addEventListener('click', resetBot);

      setupMenuToggle();
    });

    function startBot() {
      botRunning = true;
      updateUI();
      addLog('Bot initialized with ' + document.getElementById('botStrategy').value + ' strategy...');
      addLog('Trading ' + document.getElementById('botVolume').value + ' units of ' + document.getElementById('botPair').value);

      simulateBotTrade();
    }

    function simulateBotTrade() {
      if (!botRunning) return;

      const pair = document.getElementById('botPair').value;
      const volume = parseFloat(document.getElementById('botVolume').value);
      const strategy = document.getElementById('botStrategy').value;
      const tradeType = Math.random() > 0.5 ? 'BUY' : 'SELL';
      const currentBalance = parseFloat(storage.getBalance('demo') || localStorage.getItem('balance') || '10000');

      addLog('[' + strategy + '] Signal generated - ' + tradeType + ' ' + volume + ' ' + pair);

      setTimeout(() => {
        if (!botRunning) return;
        
        const profit = (Math.random() > 0.4) ? parseFloat((Math.random() * 100 + 50).toFixed(2)) : parseFloat((-(Math.random() * 100 + 25)).toFixed(2));
        const newBalance = currentBalance + profit;
        
        // Update balance in localStorage
        localStorage.setItem('balance', newBalance);
        
        if (profit > 0) {
          botStats.wins++;
          addLog('Trade closed with PROFIT: +$' + profit.toFixed(2) + ' (Balance: $' + newBalance.toFixed(2) + ')');
        } else {
          botStats.losses++;
          addLog('Trade closed with LOSS: $' + profit.toFixed(2) + ' (Balance: $' + newBalance.toFixed(2) + ')');
        }
        
        botStats.trades++;
        botStats.pnl += profit;
        updateStats();

        if (botRunning && botStats.trades < parseInt(document.getElementById('botMaxTrades').value)) {
          setTimeout(simulateBotTrade, 3000);
        } else if (botStats.trades >= parseInt(document.getElementById('botMaxTrades').value)) {
          addLog('Maximum daily trades reached. Bot stopping...');
          stopBot();
        }
      }, 2000);
    }

    function stopBot() {
      botRunning = false;
      updateUI();
      addLog('Bot stopped');
    }

    function resetBot() {
      botStats = { trades: 0, wins: 0, losses: 0, pnl: 0 };
      document.getElementById('botLog').textContent = 'Bot reset. Ready to start trading...';
      updateStats();
    }

    function addLog(message) {
      const logEl = document.getElementById('botLog');
      const time = new Date().toLocaleTimeString();
      logEl.textContent += '\n[' + time + '] ' + message;
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateStats() {
      document.getElementById('statTrades').textContent = botStats.trades;
      document.getElementById('statWins').textContent = botStats.wins;
      document.getElementById('statLosses').textContent = botStats.losses;
      document.getElementById('statPnL').textContent = '$' + botStats.pnl.toFixed(2);
    }

    function updateUI() {
      document.getElementById('startBotBtn').disabled = botRunning;
      document.getElementById('stopBotBtn').disabled = !botRunning;
      document.getElementById('botPair').disabled = botRunning;
      document.getElementById('botVolume').disabled = botRunning;
      document.getElementById('botStrategy').disabled = botRunning;

      const statusEl = document.getElementById('botStatusText');
      if (botRunning) {
        statusEl.textContent = 'Running';
        statusEl.style.color = 'var(--success)';
      } else {
        statusEl.textContent = 'Stopped';
        statusEl.style.color = 'var(--danger)';
      }
    }

    function loadBalance() {
      const balance = storage.getBalance('demo');
      document.getElementById('balance').textContent = '$' + balance.toLocaleString('en-US', {minimumFractionDigits: 2});
    }

    function setupMenuToggle() {
      const menuToggle = document.getElementById('menuToggle');
      const sideMenu = document.getElementById('sideMenu');
      const menuClose = document.querySelector('.menu-close');
      const logout = document.querySelector('.logout');
      const toggleMode = document.getElementById('toggleMode');

      if (menuToggle) menuToggle.addEventListener('click', () => sideMenu?.classList.add('active'));
      if (menuClose) menuClose.addEventListener('click', () => sideMenu?.classList.remove('active'));
      if (logout) logout.addEventListener('click', (e) => {
        e.preventDefault();
        storage.removeUser();
        window.location.href = 'index.html';
      });
      if (toggleMode) toggleMode.addEventListener('click', () => {
        document.body.classList.toggle('light-mode');
        localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
      });

      if (localStorage.getItem('theme') === 'light') {
        document.body.classList.add('light-mode');
      }
    }
  </script>
</body>
</html>
