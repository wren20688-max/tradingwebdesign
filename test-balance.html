<!DOCTYPE html>
<html>
<head>
    <title>Balance Test</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #0f1419; color: white; }
        .test { margin: 20px 0; padding: 20px; background: #1a2332; border-radius: 8px; }
        .success { color: #00d084; }
        .error { color: #ff4757; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>PreoCrypto - Balance & Chart Test</h1>
    
    <div class="test">
        <h2>1. Testing Balance Display</h2>
        <div>Current Balance: <span id="balance">$10,000.00</span></div>
        <div>Equity: <span id="equity">$10,000.00</span></div>
        <div>Today P&L: <span id="todayPnL" style="color: #00d084;">+$0.00</span></div>
        <button onclick="simulateBalanceUpdate()">Simulate Balance Update</button>
        <div id="testResults"></div>
    </div>

    <div class="test">
        <h2>2. Testing Chart Container</h2>
        <div id="mainChart" style="width: 100%; height: 450px; background: #1a2332; border: 2px solid #0055ff; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            Chart will render here...
        </div>
        <button onclick="testChartLibrary()">Test LightweightCharts Library</button>
        <div id="chartResults"></div>
    </div>

    <div class="test">
        <h2>3. Storage Test</h2>
        <button onclick="testStorage()">Test localStorage</button>
        <div id="storageResults"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.min.js"></script>
    
    <script>
        function simulateBalanceUpdate() {
            const newBalance = 10500;
            const newPnL = 500;
            
            document.getElementById('balance').textContent = '$' + newBalance.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            document.getElementById('equity').textContent = '$' + newBalance.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            document.getElementById('todayPnL').textContent = '+$' + newPnL.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            document.getElementById('testResults').innerHTML = '<span class="success">✓ Balance updated successfully!</span>';
        }

        function testChartLibrary() {
            const results = document.getElementById('chartResults');
            
            if (!window.LightweightCharts) {
                results.innerHTML = '<span class="error">✗ LightweightCharts library not loaded!</span>';
                return;
            }
            
            results.innerHTML = '<span class="success">✓ LightweightCharts library loaded!</span>';
            
            try {
                const container = document.getElementById('mainChart');
                container.innerHTML = ''; // Clear placeholder text
                
                const chart = LightweightCharts.createChart(container, {
                    width: container.clientWidth,
                    height: 450,
                    layout: {
                        background: { color: '#0f1419' },
                        textColor: '#d1d5db'
                    }
                });
                
                const candleSeries = chart.addCandlestickSeries({
                    upColor: '#00d084',
                    downColor: '#ff4757',
                    borderDownColor: '#ff4757',
                    borderUpColor: '#00d084',
                    wickDownColor: '#ff4757',
                    wickUpColor: '#00d084'
                });
                
                // Generate sample data
                const data = [];
                let baseTime = Math.floor(Date.now() / 1000) - 3600;
                let basePrice = 1.0945;
                
                for (let i = 0; i < 30; i++) {
                    const open = basePrice + (Math.random() - 0.5) * 0.001;
                    const close = basePrice + (Math.random() - 0.5) * 0.001;
                    const high = Math.max(open, close) + Math.random() * 0.001;
                    const low = Math.min(open, close) - Math.random() * 0.001;
                    
                    data.push({
                        time: baseTime + (i * 120),
                        open: open,
                        high: high,
                        low: low,
                        close: close
                    });
                    
                    basePrice = close;
                }
                
                candleSeries.setData(data);
                chart.timeScale().fitContent();
                
                results.innerHTML += '<br><span class="success">✓ Chart rendered successfully!</span>';
            } catch (err) {
                results.innerHTML += '<br><span class="error">✗ Error rendering chart: ' + err.message + '</span>';
            }
        }

        function testStorage() {
            const results = document.getElementById('storageResults');
            let html = '';
            
            try {
                localStorage.setItem('test', 'value');
                const test = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                html += '<span class="success">✓ localStorage working!</span><br>';
                
                // Check existing data
                const balance = localStorage.getItem('balance');
                const todayPnL = localStorage.getItem('todayPnL');
                
                html += '<pre>balance: ' + (balance || 'not set') + '\n';
                html += 'todayPnL: ' + (todayPnL || 'not set') + '</pre>';
                
            } catch (err) {
                html = '<span class="error">✗ localStorage error: ' + err.message + '</span>';
            }
            
            results.innerHTML = html;
        }

        // Test on load
        window.addEventListener('load', () => {
            document.body.innerHTML += '<div class="test"><strong>Auto-tests on load:</strong><div id="autoTest"></div></div>';
            
            if (window.LightweightCharts) {
                document.getElementById('autoTest').innerHTML += '<span class="success">✓ LightweightCharts loaded on page load</span><br>';
            } else {
                document.getElementById('autoTest').innerHTML += '<span class="error">✗ LightweightCharts not loaded on page load</span><br>';
            }
        });
    </script>
</body>
</html>
